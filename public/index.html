<html>

<head>
  <title>Express</title>
  <link href="https://fonts.googleapis.com/css?family=Anton|Merriweather&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
</head>

<body>
  <main id="app">
    <section v-if="!todaysChallenge">
      <p>Det finns ingen aktuell utmaning.</p>
    </section>
    <section v-if="todaysChallenge">
      <section v-show="!todaysChallenge.done">
          <h1>
            Dagens challenge
          </h1>
          <p class="challenge-text" v-html="todaysChallenge.description"></p>
          <button type="button" @click="imDone">
            Jag har gjort dagens challenge!
          </button>
        </section>
        <section v-show="todaysChallenge.done">
          BRA JOBBAT!
        </section>
    </section>
    <section>
      <section class="history-element__outer-container"
          v-for="(challenge, index) in challenges">
        <section class="history-element__inner-container"
            :class="{done:challenge.done, current:index === todaysChallengeIndex}">
          {{index+1}}
        </section>
      </section>
    </section>
  </main>

  <!-- development version, includes helpful console warnings -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script>
  const saveKey = "30daychallenge1-test";

  var app = new Vue({
    el: '#app',
    data: {
      challenges: [
        { description: "Testa att utföra metoden <a href=\"https://sv.wikipedia.org/wiki/5_x_Varf%C3%B6r%3F\" target=\"_blank\">5 x Varför?</a>", date: new Date(2019, 10, 16), done: false },
        { description: "Gå ut och detaljstudera något väldigt litet. Titta på saken riktigt nära och rita av den.", date: new Date(2019, 10, 17), done: false },
        { description: "Dela med dig av ditt bästa tips för att underlätta arbetsdagen och varför det funkar för dig.", date: new Date(2019, 10, 18), done: false },
        { description: "Skriv fritt i 15 minuter om vad du har gjort idag, vad du eventuellt har lärt dig och hur det i så fall kan hjälpa dig i fortsättningen.", date: new Date(2019, 10, 19), done: false },
        { description: "Vik pappersflygplan.", date: new Date(2019, 10, 20), done: false },
        { description: "Fråga en kollega som du inte arbetar så mycket med om vad hen gör just nu på jobbet och vad hen tycker är roligast att göra utanför jobbet.", date: new Date(2019, 10, 21), done: false },
        { description: "Gå på en promenad med en eller flera kollegor.", date: new Date(2019, 10, 22), done: false },
        { description: "Byt kontor med någon i en timme.", date: new Date(2019, 10, 23), done: false },
        { description: "Gå på en promenad med en eller flera kollegor.", date: new Date(2019, 10, 24), done: false },
        { description: "Exempelchallenge 10", date: new Date(2019, 7, 17), done: false },
        { description: "Exempelchallenge 11", date: new Date(2019, 7, 18), done: false },
        { description: "Exempelchallenge 12", date: new Date(2019, 7, 19), done: false },
        { description: "Exempelchallenge 13", date: new Date(2019, 7, 20), done: false },
        { description: "Exempelchallenge 14", date: new Date(2019, 7, 21), done: false },
        { description: "Exempelchallenge 15", date: new Date(2019, 7, 22), done: false },
        { description: "Exempelchallenge 16", date: new Date(2019, 7, 23), done: false },
        { description: "Exempelchallenge 17", date: new Date(2019, 7, 24), done: false },
        { description: "Exempelchallenge 18", date: new Date(2019, 7, 25), done: false },
        { description: "Exempelchallenge 19", date: new Date(2019, 7, 26), done: false },
        { description: "Exempelchallenge 20", date: new Date(2019, 7, 30), done: false }
      ]
    },
    mounted: function() {
      this.loadUserData();
    },
    computed: {
      todaysChallengeIndex: function() {
        let result = -1;
        let todaysDate = new Date();
        for (var i=0; i<this.challenges.length; i++) {
          let date = this.challenges[i].date;
          if (todaysDate.getFullYear() === date.getFullYear() &&
              todaysDate.getMonth() === date.getMonth() &&
              todaysDate.getDate() === date.getDate() &&
              todaysDate.getHours() >= 7 &&
              todaysDate.getHours() < 18) {
            result = i;
          }
        }
        return result;
      },
      todaysChallenge: function() {
        let result;
        let index = this.todaysChallengeIndex;
        if (index >= 0) {
          result = this.challenges[index];
        }
        return result;
      }
    },
    methods: {
      imDone: function () {
        this.todaysChallenge.done = true;
        this.saveUserData();
      },
      loadUserData: function() {
        let userData = JSON.parse(localStorage.getItem(saveKey));

        if (userData) {
          for (var i=0; i<userData.doneChallenges.length; i++) {
            let doneChallengeIndex = userData.doneChallenges[i];
            this.challenges[doneChallengeIndex].done = true;
          }
        }
      },
      saveUserData: function() {
        let userData = {
          doneChallenges: []
        };

        for (var i=0; i<this.challenges.length; i++) {
          let challenge = this.challenges[i];
          if (challenge.done) {
            userData.doneChallenges.push(i);
          }
        }

        localStorage.setItem(saveKey, JSON.stringify(userData));
      }
    }
  })
  </script>
</body>

</html>
